---
这一部分一会加上
---

感觉博弈论真的都是喵喵题。

### [AGC017 D] Game On Tree

每次删边，必然是选择根节点的一个子树，在里面删去一条边，并且不能再其他的子树里面操作第二次。

又考虑到，根节点的每一个子节点之前其实不会相互影响，所以如果根节点有 $k$ 个孩子，我们就可以把这棵树拆成 $k$ 个独立的游戏，每个游戏中的树的根节点分别只有一个孩子。

```
 O     O
 |     |
 O     O
/|\   / \
OOO   O O
:::   : :
```

也就是这个样子。

那么根据 Nim 和的结论，我们只需要把所有 $k$ 棵新树的 SG 函数值异或起来就可以了。所以问题转变成：在一棵树的顶上再连出一条单独的边，这棵树的 SG 函数值会如何变化。如果解决了这个问题，我们就可以用一次 DP 求出整棵树的 SG 函数了

考虑把博弈对应的有向图画出来。在树根（不妨称为 $v$）上新连一条边 $(u,v)$ 后，博弈图中每一个点都有了一条新的出边，连向代表【整棵树仅剩一个点 $u$】对应的局面。

> 这是因为在游戏的任意时刻，玩家都可以选择删掉边 $(u,v)$，让树中仅剩下点 $u$ .

而显然这个多出来的点的 SG 值为 $0$，那么原先博弈图中 SG 函数为 $0$ 的点们，加上连向超级汇点的边后，他们的 SG 值会变成 $1$ .

所有原先 SG 值为 $1$ 的点，其原先的所有后继的 SG 值均增加 $1$，并且新增了一个 SG 值为 $0$ 的后继，那么它的 SG 值变成 $2$ . 以此类推，每个点的后继的 SG 值整体偏移 $+1$，并且新增了一个 SG 值为 $0$ 的后继。

所以，加上边 $(u,v)$ 后，这棵树的 SG 函数值恰好增加 $1$ .

然后这道题就做完了。

### [QOJ4177] E&D

无脑打表观察题目。

这里提供一种对于分块矩阵找规律的便捷方法。

首先发现一些特殊位置上的值是可以确定的（具体来说，奇数位置上的值全部为 $0$）。

然后发现矩阵具有周期性，把 $2\times 2$ 的方格缩为一点，舍去其中为 $0$ 的部分，发现所有奇数位置的新点都是 $1$ .

依次反复类推即可找出规律。

更一般化的技巧是，面对具有周期性质的矩阵，考虑一个最小块是否能用一个值表示，如果可以的话，把这些新的值构成的新的矩阵写出来，观察是否和原阵本质同构。

### [QOJ1827] Token Game

标算没有意思，我们考虑另一种解法 。

观察发现，如果两个棋子挨在一起，那么先手必败。

> 怎么观察出来的？首先考虑最平凡的失败情况，然后考虑能不能通过模仿棋的方式把它拓展。
> 
> 具体思路为：首先观察到最终状态一定是两个棋子在最右上角，如果最后两步是模仿棋的话，那么倒数第三个局面时，两个棋子应该在棋盘的某处紧贴在一起。此时先手无论采取什么操作都不能反败为胜，遂得出结论。

更进一步可以推出，如果两个棋子位于同一行/同一列，且中间有空格，那么先手必胜。也可以推出如果有一维上两个棋子的坐标相差 $1$，那么先手必胜（因为可以直接转化为紧贴的情况）。

两者结合，即移动完毕后一维上坐标之差 $\leq 1$ 时，刚刚完成移动的玩家必败。

> 这样就排除了两个棋子紧挨的特殊情况，因为在最后一次移动前，这两个棋子肯定在某一维度上间距 $\leq 1$ .

那我们可以改换游戏条件：两棋子在棋盘上行走，途中任意时刻，两维度上两棋子的间距必须 $>1$，第一个不能移动的人输。

> 对于那些一开始就相邻的特殊情况，直接特判即可。

显然，在决出胜负之前，棋盘上两个棋子任意一维的间距都是 $>1$ 的，也就是说棋子不会相互阻挡，两个维度互不影响。

这意味着什么？无论两个棋子的 $y$ 坐标如何，任意一个棋子在 $x$ 轴上能移动的位置是不会改变的。

换句话说，如果决定在 $x$ 方向移动棋子 $A$，那么无论 $A,B$ 的纵坐标如何，【$A$ 所有能走到的位置】都是相同的。

这启示我们把游戏拆成两维。游戏的 SG 值就是两个游戏的 Nim 和。

> 为什么？
> 
> 考虑Nim和结论成立的两个条件：
> 
> 1. 每次行动玩家只能选择一个游戏走一步，不能不走也不能都走。
> 2. 大游戏失败的条件是两个子游戏中此玩家均失败。
> 
> 第一点的成立是显然的。
> 
> 对于第二点，在现在的情境中，在某一维度的子游戏中“失败”意味着：如果**下一步**走这个维度，我们只能让两棋子在这一维度上间距 $\leq 1$，从而使自己落败。
> 
> 所以只有两个维度自己都无法走下去时，才会全局失败。
> 
> 不要误认为这个游戏的“失败”是指我们**已经**让两个棋子某一维上间距 $\leq 1$，这既不符合定义，而且一旦一个维度（子游戏）发生这个情况时我们将满盘皆输。

> 这引出了一个技巧：如果两个子游戏组合后，落败条件是：“一旦有一个游戏中失败，则该玩家全局失败”。
> 
> 则我们可以把两个子游戏对应的 DAG 中所有败点剥离掉，剩下两个新的 DAG 组成一个大游戏。在这个新游戏中，落败的条件变成了适用于Nim和的“两个游戏均失败时，此玩家失败”。
> 
> 具体体现在DP上，就是禁止某些状态在DP的过程中出现。
> 
> 当然也可以处理其他获胜条件的情况，比如两个人轮流裁剪坐标纸，首先裁出 $1\times 1$ 的方格的玩家获胜（每次裁出的两张纸片均保留），那么我们可以把所有形如 $1\times n$ 设为败点，在此基础上推导 SG 。

那么对一个维度 DP，状态直接设成 $f[i,j] = \text{SG}(i,j)$ . 暴力求 $\text{mex}$ 复杂度是 $O(m^3)$ .

询问都是 $\sum_{x=1}^{x_2}\big[\text{SG}(x_1,x) = \text{SG}(y_1,y_2)\big]$ 的形式，直接 $O(nm)$ 查询即可。

成功踩标算！