# GSS1

## 题意

给定一个序列，支持询问最大子段和。

## 做法

看起来像线段树，的确也是线段树。但是如果把数据范围开到 $n=5\times 10^4,q=10^6$ 呢？

有一种数据结构叫做**猫树**，简单来说就是在线段树的每个节点上，从中间开始向两端维护一点东西，一般是前缀和或者后缀和什么的。

然后我们只需要找到完全包含某个询问的最小线段树区间，就可以 $O(1)$ 处理询问了。这里还要用到一个技巧，这个我们要找的线段树区间的编号正好是 $L,R$ 的二进制数码的 LCP（前提是线段树为满二叉树且用堆式存储），而这个东西其实就是 `L>>Log2[L^R]` .

# GSS2

## 题意

和上面的类似，但是子段和中一个数只能被计算一次。

## 做法

感觉看不到一丝一毫在线做的可能性，因为你必须面对一个把多个集合合并之后去重的问题。

那么考虑离线？

> 扫 $l$ 端点意味着从区间里面删除数据是简单的，扫 $r$ 端点意味着向区间里面加入数据是简单的。

这道题而言，向集合里面加入新数，某个后缀的去重和变化量是相当容易计算的，只需要找到 $A_r$ 上一次出现的位置，后缀 $+1$ 即可。

所以我们扫描线的同时用线段树维护所有后缀的去重后区间和。

而查询最大子段和，相当于查询一个后缀的历史最大值。这里的“后缀”相当于枚举了子段的左端点，“历史”相当于枚举了子段的右端点。

## Link

历史最大值是一个常见的维护信息，涉及到操作序列拼接等知识。

[SDOI2009]HH的项链

# GSS3

GSS1 带了个单点修改，就不讲了。

# GSS4

## 题意

给定一个序列，值域 $[1,10^{18}]$，支持区间开方、查询区间和。

## 做法

经典套路，开平方根后，如果得到了零或者一，那么之后无论怎么操作都不会变了，并且指数函数增长率十分高，一个区间最多会被开十次平方根，所以暴力维护即可。

等等，如果带了个区间加的操作呢？



## Link

这一性质被称为势能线段树或 $\text{Seg-Beats}$，具体表现为每一次操作都会让后面的“操作空间”减少，所以采用恰当的暴力算法可以在均摊复杂度下通过这种题目。

