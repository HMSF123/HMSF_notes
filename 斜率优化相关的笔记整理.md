---
title: 斜率优化相关的笔记整理
updated: 2022-10-21 11:54:49Z
created: 2022-10-20 12:57:41Z
---

# 斜率优化相关的笔记整理

# Part 1 斜率优化

有相当一部分DP的状态转移方程都有如下的形式

$$
F[i]=\min_{j=L(i)}^{R(i)}\left\{F[j]+f(j)g(i)\right\}\tag{A}
$$

而这样的方程用一般转移方法，时间复杂度为 $O(n^2)$ ,但是可以通过**斜率优化**的方法将其复杂度减少到 $O(n)\sim O(n\log^2n)$ (具体复杂度视题目而定)，从而避免超时。

> 在《进阶指南》和很多其他文章中，$\left[L(i),R(i)\right]$ 这个集合（也就是在其中枚举 $j$ 的集合）被称为对于 $F[i]$ 的“**决策集合**”，这里也采用这种称呼

在开始优化之前，先明确式A中各项的意义

- $F[i]$ 是一个未知的量，我们需要在转移过程中“填上”它

- $L(i),R(i)$ 分别是在计算 $F[i]$ 的过程中可以用来转移的“决策集合”的上下界

- $F[j]~~(j\in\big[L(i),R(i)\big])$ 都是已知数

- $f(j),g(i)$ 是两个普通的函数，并且必须可以 $O(1)$ 计算

为了便于讲解斜率优化的原理，先对转移方程做一些变形。

我们强行去掉A式中的 $\min$ 符号，并且保留 $j$ 的取值范围，接着把 $f(j)g(i)$ 这一项移动到等式左侧得到这样的B式（可以看做一个关于 $F[i]$ 的一元方程）

$$
F[i]-f(j)g(i)=F[j]\quad\big(~j\in[L(i),R(i)]~\big)\tag{B}
$$

现在根据B式，转移的意义就变成了

1. 遍历决策集合中的所有 $j$ 

2. .找到一个特定的 $j'$ ,使得将 $j'$ 代入后解出的 $F[i]$ 最小.

3. 最后将这个最小的  $F[i]$ 作为答案保存”

接下来我们需要关注整个转移过程的**几何意义**，我们先发现，再遍历的过程中，发生改变的有 $F[j],f(j)$ 这两个部分，所以先把他们看作若干个二维平面上的点对 $\big(\,f(j),F[j]\,\big)$ ，换句话说，把 $f(j)$ 看作横坐标 $x$，$F[j]$ 看作纵坐标 $y$ 。这样可以得到如下的一张图

IMG_1

接下来重新观察B式，把 $f(j)$ 换成 $x$，把 $F[j]$ 换成 $y$ 可以得到这样的C式

$$
F[i]-g(i)\cdot x=y\\
y=-g(i)\cdot x+F[i]\tag{C}
$$

很容易发现C式长得很像熟悉的**直线方程** $y=kx+b$，所以对于每一组确定的 $(x,y)$ ， C式可以看做**过平面上一点 $(x,y)$ 的一条斜率为 $-g(i)$ 的直线**，而这条直线的**截距**正是我们要求的 $F[i]$ .

再看一眼刚刚提到的B式中转移的意义，可以稍加更改，变成C式中转移的意义：

1. 考虑到我们规定了 $x=f(j)\,,y=F[i]$ ，所以先在决策集合内枚举 $j$ ,依次将每一对 $(f(j),F[i])$ 当做 $(x,y)$ 代入C式中
2. 解得直线的斜率 $F[i]$
3. 将整个枚举过程中解出来过最小的 $F[i]$ 作为答案保存

如果用几何意义来解释的话，就是在下面的图中过每一个点作一条斜率为 $-g(i)$ 的直线，并找到那个“能让过它的直线的截距最小”的点，然后把这个截距保存

IMG_2

又考虑到，在转移的过程中 $i$ 的取值是不会变的，所以无论 $j$ 是多少，函数 $g(i)$ 的取值都是不变的，进而可以得知转移就是把一条斜率固定的直线上下平移，并找到一个 决策点集 中的点，使得直线经过这个点时在y轴上的截距最小。如下图所示：

IMG_3

> 到了这一步其实还没有进行真正的优化，刚刚所做的一切都是为了引出后面的优化方法。

我们继续观察刚刚得到的图示，可以发现，有一些点是**无论如何**也不会作为一个“决策点”被选中的，那么其实也就没有必要记录这些点的信息。

